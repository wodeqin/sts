!function(e,t,n){"use strict";function i(t,n){return this.element=t,this.$element=e(t),this.config=e.extend({},s,n),this.internals={objectRefs:{}},this.init(),this}var a="dateDropdowns",s={defaultDate:null,defaultDateFormat:"yyyy-mm-dd",displayFormat:"dmy",submitFormat:"yyyy-mm-dd",minAge:0,maxAge:120,minYear:null,maxYear:null,submitFieldName:"date",wrapperClass:"date-dropdowns",dropdownClass:null,daySuffixes:!0,monthSuffixes:!0,monthFormat:"long",required:!1};i.message={day:"日",month:"月",year:"年"},e.extend(i.prototype,{init:function(){this.checkForDuplicateElement(),this.setInternalVariables(),this.setupMarkup(),this.buildDropdowns(),this.attachDropdowns(),this.bindChangeEvent(),this.config.defaultDate&&this.populateDefaultDate()},checkForDuplicateElement:function(){return e('input[name="'+this.config.submitFieldName+'"]').length?(e.error("Duplicate element found"),!1):!0},setInternalVariables:function(){var e=new Date;this.internals.currentDay=e.getDate(),this.internals.currentMonth=e.getMonth()+1,this.internals.currentYear=e.getFullYear(),this.internals.monthShort=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],this.internals.monthLong=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"]},setupMarkup:function(){var t,n;if("input"===this.element.tagName.toLowerCase()){this.config.defaultDate||(this.config.defaultDate=this.element.value),n=this.$element.attr("type","hidden").wrap('<div class="'+this.config.wrapperClass+'"></div>');var i=this.config.submitFieldName!==s.submitFieldName,a=this.element.hasAttribute("name");a||i?i&&this.$element.attr("name",this.config.submitFieldName):this.$element.attr("name",s.submitFieldName),t=this.$element.parent()}else n=e("<input/>",{type:"hidden",name:this.config.submitFieldName}),this.$element.append(n).addClass(this.config.wrapperClass),t=this.$element;return this.internals.objectRefs.pluginWrapper=t,this.internals.objectRefs.hiddenField=n,!0},buildDropdowns:function(){var e,t,n;return e=this.buildDayDropdown(),this.internals.objectRefs.dayDropdown=e,t=this.buildMonthDropdown(),this.internals.objectRefs.monthDropdown=t,n=this.buildYearDropdown(),this.internals.objectRefs.yearDropdown=n,!0},attachDropdowns:function(){var e=this.internals.objectRefs.pluginWrapper,t=this.internals.objectRefs.dayDropdown,n=this.internals.objectRefs.monthDropdown,i=this.internals.objectRefs.yearDropdown;switch(this.config.displayFormat){case"mdy":e.append(n,t,i);break;case"ymd":e.append(i,n,t);break;case"dmy":default:e.append(t,n,i)}return!0},bindChangeEvent:function(){var e=this.internals.objectRefs.dayDropdown,t=this.internals.objectRefs.monthDropdown,n=this.internals.objectRefs.yearDropdown,i=this,a=this.internals.objectRefs;a.pluginWrapper.on("change","select",function(){var s,r,o=e.val(),d=t.val(),l=n.val();return(s=i.checkDate(o,d,l))?(a.dayDropdown.addClass("invalid"),!1):("00"!==a.dayDropdown.val()&&a.dayDropdown.removeClass("invalid"),a.hiddenField.val(""),s||o*d*l===0||(r=i.formatSubmitDate(o,d,l),a.hiddenField.val(r)),void a.hiddenField.change())})},populateDefaultDate:function(){var e=this.config.defaultDate,t=[],n="",i="",a="";switch(this.config.defaultDateFormat){case"yyyy-mm-dd":default:t=e.split("-"),n=t[2],i=t[1],a=t[0];break;case"dd/mm/yyyy":t=e.split("/"),n=t[0],i=t[1],a=t[2];break;case"mm/dd/yyyy":t=e.split("/"),n=t[1],i=t[0],a=t[2];break;case"unix":t=new Date,t.setTime(1e3*e),n=t.getDate()+"",i=t.getMonth()+1+"",a=t.getFullYear(),n.length<2&&(n="0"+n),i.length<2&&(i="0"+i)}return this.internals.objectRefs.dayDropdown.val(n),this.internals.objectRefs.monthDropdown.val(i),this.internals.objectRefs.yearDropdown.val(a),this.internals.objectRefs.hiddenField.val(e),!0===this.checkDate(n,i,a)&&this.internals.objectRefs.dayDropdown.addClass("invalid"),!0},buildBaseDropdown:function(t){var n=t;return this.config.dropdownClass&&(n+=" "+this.config.dropdownClass),e("<select></select>",{"class":n,name:this.config.submitFieldName+"_["+t+"]",required:this.config.required})},buildDayDropdown:function(){var e,t=this.buildBaseDropdown("day"),a=n.createElement("option");a.setAttribute("value",""),a.appendChild(n.createTextNode(i.message.day)),t.append(a);for(var s=1;10>s;s++)this.config.daySuffixes&&(e="0"+s),a=n.createElement("option"),a.setAttribute("value","0"+s),a.appendChild(n.createTextNode(e)),t.append(a);for(var r=10;31>=r;r++)e=r,this.config.daySuffixes&&(e=r),a=n.createElement("option"),a.setAttribute("value",r),a.appendChild(n.createTextNode(e)),t.append(a);return t},buildMonthDropdown:function(){var e=this.buildBaseDropdown("month"),t=n.createElement("option");t.setAttribute("value",""),t.appendChild(n.createTextNode(i.message.month)),e.append(t);for(var a=1;12>=a;a++){var s;switch(this.config.monthFormat){case"short":s=this.internals.monthShort[a-1];break;case"long":s=this.internals.monthLong[a-1];break;case"numeric":s=a,this.config.monthSuffixes&&(s+=this.getSuffix(a))}10>a&&(a="0"+a),t=n.createElement("option"),t.setAttribute("value",a),t.appendChild(n.createTextNode(s)),e.append(t)}return e},buildYearDropdown:function(){var e=this.config.minYear,t=this.config.maxYear,a=this.buildBaseDropdown("year"),s=n.createElement("option");s.setAttribute("value",""),s.appendChild(n.createTextNode(i.message.year)),a.append(s),e||(e=this.internals.currentYear-(this.config.maxAge+1)),t||(t=this.internals.currentYear-this.config.minAge);for(var r=t;r>=e;r--)s=n.createElement("option"),s.setAttribute("value",r),s.appendChild(n.createTextNode(r)),a.append(s);return a},getSuffix:function(){var e="";return e},checkDate:function(e,t,n){var i;if("00"!==t){var a=new Date(n,t,0).getDate(),s=parseInt(e,10);i=this.updateDayOptions(a,s),i&&this.internals.objectRefs.hiddenField.val("")}return i},updateDayOptions:function(e,t){var i=parseInt(this.internals.objectRefs.dayDropdown.children(":last").val(),10),a="",s="",r=!1;if(i>e){for(;i>e;)this.internals.objectRefs.dayDropdown.children(":last").remove(),i--;t>e&&(r=!0)}else if(e>i)for(;e>i;){a=++i,s=a,this.config.daySuffixes&&(s+=this.getSuffix(i));var o=n.createElement("option");o.setAttribute("value",a),o.appendChild(n.createTextNode(s)),this.internals.objectRefs.dayDropdown.append(o)}return r},formatSubmitDate:function(e,t,n){var i,a;switch(this.config.submitFormat){case"unix":a=new Date,a.setDate(e),a.setMonth(t-1),a.setYear(n),i=Math.round(a.getTime()/1e3);break;default:i=this.config.submitFormat.replace("dd",e).replace("mm",t).replace("yyyy",n)}return i},destroy:function(){var e=this.config.wrapperClass;if(this.$element.hasClass(e))this.$element.empty();else{var t=this.$element.parent(),n=t.find("select");this.$element.unwrap(),n.remove()}}}),e.fn[a]=function(t){return this.each(function(){if("string"==typeof t){var n=Array.prototype.slice.call(arguments,1),s=e.data(this,"plugin_"+a);if("undefined"==typeof s)return e.error("Please initialize the plugin before calling this method."),!1;s[t].apply(s,n)}else e.data(this,"plugin_"+a)||e.data(this,"plugin_"+a,new i(this,t))}),this}}(jQuery,window,document);